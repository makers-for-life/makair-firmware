<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>software:firmware: Changelog</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">software:firmware
   </div>
   <div id="projectbrief">MakAir Firmware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Changelog </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_CHANGELOG"></a> </p>
<h1><a class="anchor" id="autotoc_md8"></a>
unreleased</h1>
<ul>
<li>fixed malformatted fatal error telemetry messages (<em>existing ones did not pass CRC checks</em>)</li>
<li>implemented new fatal error telemetry messages (<em>SFM sensor failure, battery deep discharge, calibration errors</em>)</li>
<li>sending "end of production line" telemetry snapshots (<em>used for the UI to show current EOL step</em>)</li>
<li>handling "end of production line" control messages (<em>used to continue to next EOL step</em>)</li>
<li>if hardware buttons are disabled, then the "end of production line" will skip the buttons test step</li>
<li>added automation and convenience scripts (<em>used to compile and flash to auto-detected serial port</em>)</li>
<li>refactored project structure (<em>some directories and files have been moved</em>)</li>
</ul>
<h1><a class="anchor" id="autotoc_md9"></a>
v4.0.0</h1>
<ul>
<li>drop support of electronic hardware v1 and v2 (<em>from now on, minimum compatibility is from v3</em>)</li>
<li>refactor main loop and breathing control (<em>breathing-related computations are now triggered by a hardware timer</em>)</li>
<li>support several breathing modes (<em>PC-CMV stays the default mode, PC-VSAI and PC-AC were added</em>)</li>
<li>added volume controlled ventilation modes (<em>VC-CMV and VC-AC were added</em>)</li>
<li>telemetry protocol v2 was introduced (<em>basically, this means sending more data</em>)</li>
<li>drop support of useless "qualification" and "integration test" modes (<em>both are superseded by the EOL test feature</em>)</li>
<li>add a watchdog for the Raspberry Pi (<em>RPi power supply will be restarted if UI misses sending heartbeats</em>)</li>
<li>allow to set any setting (current or added) using the serial control protocol (<em>new settings were added, and they can all be changed from UI software</em>)</li>
<li>improve breathing control algorithms</li>
<li>remove ability to set peak pressure</li>
<li>allow to snooze alarms or start/stop breathing using the serial control protocol</li>
<li>drop support of old valves and pneumatic systems</li>
<li>make mass flow meter more reliable</li>
<li>support for SFM mass flow meters (<em>SFM3019 and SFM_3300D</em>)</li>
<li>added support for a mass flow meter on the expiratory branch (<em>if it is missing, the expiratory flow rate will be estimated using an algorithm</em>)</li>
<li>turn the green LED on when alarms are snoozed</li>
<li>added a facility to pre-configure the ventilator settings upon boot, using a patient height setting (<em>submitting the patient height will update all ventilation hyperparameters to optimum values</em>)</li>
<li>added configurable alarms for pressure and volume modes, adding to all existing alarms</li>
<li>sending more measured values for display, e.g. respiratory durations and cycles per minute</li>
<li>a more precise battery voltage value is now sent over the telemetry protocol (<em>this is used for battery SoC estimations</em>)</li>
<li>display a special message on LCD screen when watchdog reset was triggered</li>
<li>ability to detect in a reliable way when AC gets off, and that power is switched to battery</li>
<li>allow to retry pressure calibration when it fails</li>
<li>added a ramp-up algorithm on the blower speed controller, in order to prevent current surges in the transformer, which could trigger a temporary handover on batteries (<em>this is a security feature, in cases where batteries would be depleted or not connected, the ventilator would suddenly reboot during use</em>)</li>
<li>added a compilation flag to disable all hardware buttons (<em>this is used for touchscreen-only MakAir devices, i.e. non-traditional ones</em>)</li>
<li>added basic support for the motherboard V3 EEPROM chip over I2C (<em>disabled by default until stable</em>)</li>
<li>a lot of potential exceptions due to possible divisions by zero have been fixed</li>
<li>increase the size of the hardware buffer used by telemetry</li>
<li>improve Doxygen documentation</li>
</ul>
<h1><a class="anchor" id="autotoc_md10"></a>
v3.0.1</h1>
<ul>
<li>fix an issue with the optional mass flow meter</li>
</ul>
<h1><a class="anchor" id="autotoc_md11"></a>
v3.0.0</h1>
<ul>
<li>implement a respiratory trigger (<em>this helps the MakAir to respect the patient respiratory reflexes when he/she starts to wake up; disabled by default</em>)</li>
<li>add an "end of production line" test program (<em>it is included in the production software and runs when booting while pressing a maintainance button; electronic hardware v2+ required</em>)</li>
<li>support Faulhaber motors for valves (<em>they are better, faster, stronger; electronic hardware v2+ required</em>)</li>
<li>support an optional mass flow meter (<em>this allows to estimate the volume of inspired air; electronic hardware v2+ required</em>)</li>
<li>implement a control protocol to update settings through serial communication (<em>UI on Raspberry Pi can now send new settings values; few more settings are supported compared to physical buttons; electronic hardware v2+ required</em>)</li>
<li>support electronic hardware v3</li>
<li>improve pressure control</li>
<li>improve blower speed regulation</li>
<li>fix systick overflow in telemetry protocol</li>
<li>update telemetry protocol to send more information</li>
<li>include CRC in telemetry messages</li>
<li>add a safety to shutdown system if battery is very low (<em>in this situation, everything might get damaged if not shutdown</em>)</li>
<li>change some default settings (<em>now, Ppeak starts at 250 mmH2O and Pplateau at 220 mmH2O</em>)</li>
</ul>
<h1><a class="anchor" id="autotoc_md12"></a>
v1.5.4</h1>
<ul>
<li>improve dynamic update of the peak pressure command according to the measured plateau pressure</li>
<li>fix telemetry bugs</li>
<li>fix minor bugs</li>
</ul>
<h1><a class="anchor" id="autotoc_md13"></a>
v1.5.3</h1>
<ul>
<li>warn if pressure is not stable enough at startup</li>
<li>improve pressure control</li>
<li>fix a regression (<em>the PPeak+ button was not functioning anymore</em>)</li>
</ul>
<h1><a class="anchor" id="autotoc_md14"></a>
v1.5.2</h1>
<ul>
<li>improve pressure control</li>
</ul>
<h1><a class="anchor" id="autotoc_md15"></a>
v1.5.1</h1>
<ul>
<li>calibrate pressure sensor's offset on startup</li>
<li>better round displayed pressure values (in cmH2O)</li>
<li>minor improvement to the pressure control</li>
</ul>
<h1><a class="anchor" id="autotoc_md16"></a>
v1.5.0</h1>
<ul>
<li>rework pressure and blower control (<em>blower will now take more time to ramp up/down but this will greatly improve the stability of injected air volume in many scenario</em>)</li>
<li>rework alarms (<em>better pressure alarms, better battery alarms, better snooze behavior</em>)</li>
<li>improve even more the measured and displayed pressures (<em>if no plateau pressure if found, screen will now display a <code>?</code> instead of an uncertain value</em>)</li>
<li>tweak the pressure control to make the plateau more accurate</li>
<li>fix an issue with blower not restarting in some cases</li>
<li>make sysclock more accurate</li>
<li>improve code quality (MISRA)</li>
<li>add a step in integration test to check O2 pipe</li>
</ul>
<h1><a class="anchor" id="autotoc_md17"></a>
v1.4.0</h1>
<p><em>This release was depublished</em></p>
<h1><a class="anchor" id="autotoc_md18"></a>
v1.3.2</h1>
<ul>
<li>fix blower control (<em>it used to unexpectedly slow down a bit from times to times</em>)</li>
<li>improve the measured and displayed pressures for peak and plateau</li>
</ul>
<h1><a class="anchor" id="autotoc_md19"></a>
v1.3.1</h1>
<ul>
<li>use the green LED near the start button to show whether the breathing mode is ON or not</li>
<li>disable alarms related to the breathing cycle when program is stopped</li>
<li>fix an issue with a battery alarm being briefly triggered at every boot</li>
<li>integration test: open both valves at startup</li>
</ul>
<h1><a class="anchor" id="autotoc_md20"></a>
v1.3.0</h1>
<ul>
<li>add a program to test integration</li>
<li>support electronic hardware v1 <b>and</b> v2 (<em>v1 by default, v2 through a config flag</em>)</li>
<li>implement start/stop (<em>from now on, machine will begin stopped!</em>)</li>
<li>handle Emerson valves (<em>through a config flag</em>)</li>
<li>improve the way buzzer is controlled</li>
</ul>
<h1><a class="anchor" id="autotoc_md21"></a>
v1.2.3</h1>
<ul>
<li>fix an issue with buzzer (sometimes it was stuck buzzing whereas no alarm were triggered)</li>
<li>add battery-related alarms</li>
</ul>
<h1><a class="anchor" id="autotoc_md22"></a>
v1.2.2</h1>
<ul>
<li>handle several pneumatic systems _(for the first 2 working typologies of prototype)_</li>
</ul>
<h1><a class="anchor" id="autotoc_md23"></a>
v1.2.1</h1>
<p><em>Unreleased</em></p>
<h1><a class="anchor" id="autotoc_md24"></a>
v1.2.0</h1>
<p>First release version </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
